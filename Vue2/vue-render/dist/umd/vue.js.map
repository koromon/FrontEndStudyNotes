{"version":3,"file":"vue.js","sources":["../../src/compiler/astParser.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["/*\n * @Description:\n * @Author: chenming.feng\n * @Date: 2021-08-03 00:24:56\n * @LastEditors: chenming.feng\n * @LastEditTime: 2021-08-05 00:29:24\n */\n\n/*\n<div id=\"app\" style=\"color: red;font-size: 20px\">\n  你好， {{name}}\n  <span class=\"text\" style=\"color: green;\">{{age}}</span>\n</div>\n*/\n// 不断用正则匹配 DOM 元素，生成 AST\n\n// Regular Expressions for parsing tags and attributes\n// id=\"app\" id='app' id=app\nconst attribute =\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\n// 匹配标签名\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\n// 匹配特殊标签 <my:header></my:header>\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\n// <div\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\n// > />\nconst startTagClose = /^\\s*(\\/?)>/;\n// </div>\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\n\nfunction parseHtmlToAst(html) {\n  let text;\n\n  while (html) {\n    let textEnd = html.indexOf(\"<\");\n    if (textEnd === 0) {\n      const startTagMatch = parseStartTag();\n      if (startTagMatch) {\n        start(startTagMatch.tagName, startTagMatch.attrs);\n        // 如果 < 是起始标签的开始，那么就没必要走下去了，下面是结束标签的 <\n        continue;\n      }\n\n      const endTagMatch = html.match(endTag);\n      // 结束标签并没有属性，所以不用做特殊处理\n      if (endTagMatch) {\n        console.log(endTagMatch);\n        advance(endTagMatch[0].length);\n        end(endTagMatch[1]);\n        continue;\n      }\n    }\n    if (textEnd > 0) {\n      text = html.substring(0, textEnd);\n    }\n    // 处理文本\n    if (text) {\n      advance(text.length);\n      chars(text);\n    }\n  }\n  // 各种解析用的函数\n\n  function parseStartTag(tag) {\n    const start = html.match(startTagOpen);\n    console.log(\"#@#@#@\", start);\n    let end, attr;\n    if (start) {\n      const match = {\n        tagName: start[1],\n        attrs: [],\n      };\n      advance(start[0].length);\n      // 如果没有遇到结束符，并且存在属性\n      while (\n        !(end = html.match(startTagClose)) &&\n        (attr = html.match(attribute))\n      ) {\n        match.attrs.push({\n          name: attr[1],\n          value: attr[3] || attr[4] || attr[5],\n        });\n        advance(attr[0].length);\n      }\n      // 遇到结束标签\n      if (end) {\n        advance(end[0].length);\n        return match;\n      }\n    }\n  }\n  // 解析后要删除对应的字符串\n  function advance(n) {\n    console.log(\"======截取函数=========\");\n    html = html.substring(n);\n  }\n\n  function start(tagName, attrs) {\n    console.log(\"======开始=========\");\n    console.log(tagName, attrs);\n  }\n\n  function end(tagName) {\n    console.log(\"======结束=========\");\n    console.log(tagName);\n  }\n\n  function chars(text) {\n    console.log(\"======文本=========\");\n    console.log(text);\n  }\n}\n\nfunction createASTElement(tagName, attrs) {\n  return {\n    tag: tagName,\n    type: 1,\n    children: [],\n    attrs,\n    parent,\n  };\n}\n\nexport { parseHtmlToAst };\n","/*\n * @Description:\n * @Author: chenming.feng\n * @Date: 2021-08-03 00:01:44\n * @LastEditors: chenming.feng\n * @LastEditTime: 2021-08-28 15:22:37\n */\nimport { parseHtmlToAst } from \"./astParser\";\n\nfunction compileToRenderFunction(html) {\n  const ast = parseHtmlToAst(html);\n  let code = generate(ast);\n  console.log(\"code\", code);\n}\n\nexport { compileToRenderFunction };\n","/*\n * @Description:\n * @Author: chenming.feng\n * @Date: 2021-08-02 21:59:48\n * @LastEditors: chenming.feng\n * @LastEditTime: 2021-08-03 00:27:42\n */\n\nimport { initState } from \"./state\";\nimport { compileToRenderFunction } from \"./compiler\";\n\nfunction initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n\n    vm.$options = options;\n\n    initState(vm);\n\n    if (vm.$options.el) {\n      // 执行挂载函数\n      vm.$mount(vm.$options.el);\n    }\n  };\n\n  Vue.prototype.$mount = function (el) {\n    const vm = this,\n      options = vm.$options;\n    el = document.querySelector(el);\n    vm.$el = el;\n\n    if (!options.render) {\n      // 不存在的时候需要做处理，存在的直接根据函数渲染即可\n      let template = options.template;\n      if (!template && el) {\n        template = el.outerHTML;\n      }\n      // 编译 AST，将 AST 转换为 render\n      const render = compileToRenderFunction(template);\n      options.render = render;\n    }\n  };\n}\n\nexport { initMixin };\n","/*\n * @Description:\n * @Author: chenming.feng\n * @Date: 2021-08-02 20:20:07\n * @LastEditors: chenming.feng\n * @LastEditTime: 2021-08-03 00:27:04\n */\nimport { initMixin } from \"./init\";\n\nclass Vue {\n  constructor(options) {\n    this._init(options); // 相关初始化设置，这小节只专注数据劫持\n  }\n}\ninitMixin(Vue);\n\n// 模板： render > template > html模板\nlet vm = new Vue({\n  el: \"#app\",\n  data() {\n    return {\n      name: \"kk\",\n      age: 18,\n      info: {\n        job: \"student\",\n        friends: [\n          {\n            id: 1,\n            name: \"xiaohong\",\n          },\n          {\n            id: 2,\n            name: \"xiaoming\",\n          },\n        ],\n      },\n      hobby: [\"piano\", \"travel\", \"film\"],\n    };\n  },\n});\n"],"names":["attribute","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","parseHtmlToAst","html","text","textEnd","indexOf","startTagMatch","parseStartTag","start","tagName","attrs","endTagMatch","match","console","log","advance","length","end","substring","chars","tag","attr","push","name","value","n","compileToRenderFunction","ast","code","generate","initMixin","Vue","prototype","_init","options","vm","$options","el","$mount","document","querySelector","$el","render","template","outerHTML","data","age","info","job","friends","id","hobby"],"mappings":"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"}